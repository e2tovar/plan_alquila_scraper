<!DOCTYPE HTML>
<html LANG="es">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
		<meta http-equiv="Last-Modified" content="{{now.strftime('%Y-%m-%d %H:%M:%S')}}">
    <link rel="alternate" type="application/rss+xml" 
      title="RSS Plan Alquila y Plan Sia" 
      href="./pisos.rss"
    />
    <base target="_blank">
    <title>{{pisos | length | millar}} pisos</title>
    <link rel="stylesheet" href="rec/main.css">
    <script type="text/javascript" src="rec/sort_table.js"></script>
    <script type="text/javascript" src="rec/main.js"></script>
  </head>
  <body>
  <main>
    <fieldset id="zonas">
      <legend>Filtrar por:</legend>
      {% set zonas = pisos|map(attribute='distrito')|unique|sort %}
      {% for z in zonas %}
      <p>
        <input type="checkbox" value="{{z | simplify}}" name="zona" id="z{{loop.index}}"/>
        <label for="z{{loop.index}}">{{z}}</label>
      </p>
      {%endfor%}
    </fieldset>
  <table>
    <thead>
      <tr class="sortme">
        <th class="isSortable">id</th>
        <th title="Metros útiles" class="isSortable hideIfEQ">M²</th>
        <th class="isSortable">€</th>
        <th title="Dormitorios" class="isSortable hideIfEQ">D</th>
        {#<th title="Aseos" class="isSortable hideIfEQ">A</th>#}
        <th title="Planta" class="isSortable hideIfEQ">P</th>
        <th class="isSortable str hideIfEQ">Dirección</th>
        <th class="isSortable str isSortedByMe isReversed hideIfEQ">Fecha</th>
        {#
        <th>Dirección</th>
        <th class="isSortable str hideIfEQ">Distrito</th>
        <th class="isSortable str hideIfEQ">Barrio</th>
        <th title="Ascensor" class="isSortable hideIfEQ">Asc</th>
        #}
      </tr>
    </thead>
    <tbody>
    {% for p in pisos|sort(reverse=true, attribute='fecha,plan,id,precio') %}
    <tr class="{{p.plan.lower()}}" data-zona="{{p.distrito | simplify}}">
      <td data-sortkey="{{p.get_plan_id()}}" 
          class="rgh" title="{{p.plan}}/{{p.id}}"><a href="{{p.plan.lower()}}/{{p.id}}.html">{{p.id}}</a></td>
      <td class="rgh">{{p.metros | round}}</td>
      <td data-sortkey="{{p.precio}}"
          class="rgh">{{p.precio | millar}}</td>
      <td class="rgh">{{p.dormitorios}}</td>
      {#<td class="rgh">{{p.aseos}}</td>#}
      <td data-sortkey="{{p.planta}}" title="{{p.get_planta_title()}}"
          class="rgh ascensor{{p.ascensor}}">{{p.planta}}</td>
      <td data-sortkey="{{(p.distrito or 'z')+'\t'+p.direccion}}"
      ><a href="https://www.google.com/maps/place/{{p.direccion.replace(' ', '+')}},+Madrid">{{p.get_direccion()}}</a>, {{p.distrito}}</td>
      {#
      <td>{{p.distrito}}</td>
      <td>{{p.barrio}}</td>
      <td class="rgh" data-sortkey="{{p.ascensor | int}}">{{"Si" if p.ascensor else ""}}</td>
      #}
      <td data-sortkey="{{p.fecha}}.{{p.get_plan_id()}}">{{p.fecha}}</td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  </main>
	<footer>
		<p>
		Código fuente en <a href="https://github.com/s-nt-s/plan-alquila-sia">GitHub</a>.
    Si falla o tienes alguna sugerencia pon un <a href="https://github.com/s-nt-s/plan-alquila-sia/issues">issue</a>.
		</p>
	</footer>
  </body>
</html>
